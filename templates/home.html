{% extends "layout.html" %}


{% block content %}

<!-- The parent container that holds everything -->
<div class="hero-section">
    
    <!-- The Background Image -->
    <div class="hero-media-wrapper">
        <img src="{{ url_for('static', filename='img/jeremy-yap-J39X2xX_8CQ-unsplash.jpg') }}" alt="Cinema" class="hero-image">
    </div>

    <!-- The Search Container (now positioned on top) -->
    <div class="search-overlay">
        <h1>Media Catalog Dashboard</h1>
        <section class="search-container">
            <h2>Find Media</h2>
            <form action="/search" method="GET">
                <input type="text" name="name" placeholder="Search by name...">
                <button type="submit">Search</button>
            </form>
            <p><a class="link-btn" href="{{ url_for('search') }}">Advanced: Search by location</a></p>
        </section>
    </div>
</div>

    <!--Recently added section -->

    <h3>Recently Added dvds</h3>
    <table>
        <thead>
            <tr>
                <th>Title</th>
                <th>Sub Title</th>
                <th>Type</th>
                <th>Disk</th>
                <th>Purchase Date</th>
            </tr>
        </thead>
        <tbody>
            <!-- Adding a Hover to show TMDB in recently added -->
            {% for dvd in dvds %}
            <tr>
                <td class="title-cell">
                    {% set base_url = "https://www.themoviedb.org/movie/" if dvd['type'] == 'movie' else "https://www.themoviedb.org/tv/" %}
                     <a href="{{ base_url }}{{ dvd['tmdb_id'] }}" 
                        target="_blank" 
                        class="movie-link">
                        <strong>{{ dvd['title'] }}</strong>
                        <span class="hover-tip">View on TMDB ↗</span>
                        </a>
                    </td>
                    <td>{{ dvd['season_name'] }}</td>
                    <td>{{ dvd['type'] }}</td>
                    <td><code>{{ dvd['disk_type'] }}</code></td>
                    <td>{{ dvd['purchase_date'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!--Stats section -->

    <h1>Library Overview</h1>
    <div class="top-stats">
        <div class="stat-card">
            <h4>Total Collection</h4>
            <div class="stat-value">{{ "{:,}".format(counts[0].count) }}</div>
        </div>

        <div class="stat-card">
            <h4>Media Types</h4>
            <ul class="stat-list">
                {% for item in types %}
                    <li><span>{{ item.type }}</span> <strong>{{ item.count }}</strong></li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- 2. Swipeable Carousel Section -->
    <h2 style="font-size: 1rem; color: var(--text-dim); margin-bottom: 10px;">More Insights (Swipe →)</h2>
    <div class="stat-carousel">
        
        <!-- Genres Card -->
        <div class="carousel-card">
            <h4>Genres</h4>
            <ul class="stat-list">
                {% for item in genres %}
                    <li><span>{{ item.genre }}</span> <strong>{{ item.count }}</strong></li>
                {% endfor %}
            </ul>
        </div>

        <!-- Costs Card -->
        <div class="carousel-card">
            <h4>Cost Analysis</h4>
            <ul class="stat-list">
                {% for item in costs %}
                    <li><span>{{ item.type }}</span> <strong>${{ "{:,.2f}".format(item.sum) }}</strong></li>
                {% endfor %}
            </ul>
            <h4>Cost by Disk Type</h4>
            <ul class="stat-list">
                {% for item in cost_disks %}
                    <li><span>{{ item.disk_type }}</span> <strong>${{ "{:,.2f}".format(item.sum) }}</strong></li>
                {% endfor %}
            </ul>
            <h4>Cost by Store</h4>
            <ul class="stat-list">
                {% for item in cost_stores %}
                    <li><span>{{ item.store }}</span> <strong>${{ "{:,.2f}".format(item.sum) }}</strong></li>
                {% endfor %}
            </ul>
        </div>

    </div>

{% endblock %}
